<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebShop - Order Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="/css/site.css" rel="stylesheet">
</head>
<body>
    <div id="app">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"><i class="fas fa-shopping-cart"></i> WebShop</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: currentView === 'articles'}" @click="currentView = 'articles'" href="#">
                                <i class="fas fa-box"></i> Articles
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: currentView === 'subscriptions'}" @click="currentView = 'subscriptions'" href="#">
                                <i class="fas fa-newspaper"></i> Subscriptions
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: currentView === 'orders'}" @click="currentView = 'orders'" href="#">
                                <i class="fas fa-receipt"></i> Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{active: currentView === 'purchase'}" @click="currentView = 'purchase'" href="#">
                                <i class="fas fa-shopping-bag"></i> Make Purchase
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Alert Messages -->
            <div v-if="alert.show" :class="'alert alert-' + alert.type + ' alert-dismissible fade show'" role="alert">
                {{ alert.message }}
                <button type="button" class="btn-close" @click="alert.show = false"></button>
            </div>

            <!-- Articles View -->
            <div v-if="currentView === 'articles'">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-box"></i> Articles</h2>
                    <button class="btn btn-primary" @click="openArticleModal()">
                        <i class="fas fa-plus"></i> Add Article
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Price</th>
                                <th>Supplier Email</th>
                                <th>Date Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-if="!articles">
                                <td colspan="6" class="text-center">Loading articles...</td>
                            </tr>
                            <tr v-else-if="articles.length === 0">
                                <td colspan="6" class="text-center">No articles available</td>
                            </tr>
                            <tr v-else v-for="article in articles" :key="article.id">
                                <td>{{ article.name }}</td>
                                <td>{{ article.description }}</td>
                                <td>€{{ article.price.toFixed(2) }}</td>
                                <td>{{ article.supplierEmail }}</td>
                                <td>{{ formatDate(article.dateCreated) }}</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm btn-primary" @click="openArticleModal(article)">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="btn btn-sm btn-danger" @click="deleteArticle(article.id)">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Purchase View -->
            <div v-if="currentView === 'purchase'">
                <h2 class="mb-4"><i class="fas fa-shopping-bag"></i> Make a Purchase</h2>

                <div class="card">
                    <div class="card-body">
                        <form @submit.prevent="submitOrder">
                            <div class="mb-3">
                                <label class="form-label">Customer Phone Number *</label>
                                <input type="tel" class="form-control" v-model="orderForm.phoneNumber" 
                                       placeholder="+386123456789" required pattern="^\+?[1-9]\d{1,14}$">
                                <small class="text-muted">Format: +country_code + number (e.g., +386123456789)</small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Select Articles</label>
                                <div class="row">
                                    <div class="col-md-6 col-lg-4 mb-3" v-for="article in articles" :key="article.id">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" 
                                                           :value="article.id" v-model="orderForm.selectedArticles"
                                                           :id="'article-' + article.id">
                                                    <label class="form-check-label" :for="'article-' + article.id">
                                                        <strong>{{ article.name }}</strong>
                                                    </label>
                                                </div>
                                                <p class="card-text small mb-1">{{ article.description }}</p>
                                                <p class="card-text"><strong class="text-primary">€{{ article.price.toFixed(2) }}</strong></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Select Subscription Package (Optional)</label>
                                <div class="row">
                                    <div class="col-md-6 col-lg-4 mb-3" v-for="sub in subscriptions" :key="sub.id">
                                        <div class="card h-100" :class="{'border-primary': orderForm.selectedSubscription === sub.id}">
                                            <div class="card-body">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" 
                                                           :value="sub.id" v-model="orderForm.selectedSubscription"
                                                           :id="'sub-' + sub.id" name="subscription">
                                                    <label class="form-check-label" :for="'sub-' + sub.id">
                                                        <strong>{{ sub.name }}</strong>
                                                    </label>
                                                </div>
                                                <p class="card-text small mb-1">{{ sub.description }}</p>
                                                <p class="card-text"><strong class="text-primary">€{{ sub.price.toFixed(2) }}</strong></p>
                                                <p class="card-text small">
                                                    <span v-if="sub.includesPhysicalMagazine" class="badge bg-success">Physical Magazine Included</span>
                                                    <span v-else class="badge bg-secondary">Digital Only</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-secondary" @click="orderForm.selectedSubscription = null" 
                                        v-if="orderForm.selectedSubscription">
                                    Clear Subscription
                                </button>
                            </div>

                            <div class="alert alert-info">
                                <strong>Total Price: €{{ calculateTotal().toFixed(2) }}</strong>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success" :disabled="!isOrderValid()">
                                    <i class="fas fa-check"></i> Place Order
                                </button>
                                <button type="button" class="btn btn-secondary" @click="resetOrderForm()">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Article Modal -->
        <div class="modal fade" id="articleModal" tabindex="-1" role="dialog" aria-labelledby="articleModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="articleModalLabel">{{ articleForm.id ? 'Edit Article' : 'Add Article' }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="saveArticle">
                            <div class="mb-3">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" v-model="articleForm.name" required maxlength="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" v-model="articleForm.description" rows="3" maxlength="1000"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Price (€) *</label>
                                <input type="number" class="form-control" v-model.number="articleForm.price" 
                                       required min="0.01" max="1000000" step="0.01">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Supplier Email *</label>
                                <input type="email" class="form-control" v-model="articleForm.supplierEmail" required>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subscription Modal -->
        <div class="modal fade" id="subscriptionModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">{{ subscriptionForm.id ? 'Edit Subscription' : 'Add Subscription' }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form @submit.prevent="saveSubscription">
                            <div class="mb-3">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" v-model="subscriptionForm.name" required maxlength="200">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" v-model="subscriptionForm.description" rows="3" maxlength="1000"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Price (€) *</label>
                                <input type="number" class="form-control" v-model.number="subscriptionForm.price" 
                                       required min="0.01" max="1000000" step="0.01">
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                           v-model="subscriptionForm.includesPhysicalMagazine" id="physicalMag">
                                    <label class="form-check-label" for="physicalMag">
                                        Includes Physical Magazine
                                    </label>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Details Modal -->
        <div class="modal fade" id="orderDetailsModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Order Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" v-if="selectedOrder">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>Order Number:</strong> {{ selectedOrder.orderNumber }}
                            </div>
                            <div class="col-md-6">
                                <strong>Status:</strong> 
                                <span :class="'badge bg-' + getStatusColor(selectedOrder.status)">{{ selectedOrder.status }}</span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>Customer Phone:</strong> {{ selectedOrder.customerPhoneNumber }}
                            </div>
                            <div class="col-md-6">
                                <strong>Date:</strong> {{ formatDate(selectedOrder.dateCreated) }}
                            </div>
                        </div>

                        <h6 class="mt-4">Articles:</h6>
                        <table class="table table-sm" v-if="selectedOrder.articles && selectedOrder.articles.length > 0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in selectedOrder.articles" :key="item.articleId">
                                    <td>{{ item.name }}</td>
                                    <td>{{ item.quantity }}</td>
                                    <td>€{{ item.price.toFixed(2) }}</td>
                                </tr>
                            </tbody>
                        </table>
                        <p v-else class="text-muted">No articles in this order</p>

                        <h6 class="mt-3">Subscription Package:</h6>
                        <div v-if="selectedOrder.subscriptionPackage">
                            <p><strong>{{ selectedOrder.subscriptionPackage.name }}</strong> - €{{ selectedOrder.subscriptionPackage.price.toFixed(2) }}</p>
                        </div>
                        <p v-else class="text-muted">No subscription package</p>

                        <div class="alert alert-info mt-4">
                            <strong>Total Price: €{{ selectedOrder.totalPrice.toFixed(2) }}</strong>
                        </div>

                        <div class="mt-3">
                            <label class="form-label"><strong>Update Status:</strong></label>
                            <select class="form-select" v-model="selectedOrder.status" @change="updateOrderStatus(selectedOrder.id, selectedOrder.status)">
                                <option value="Pending">Pending</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
